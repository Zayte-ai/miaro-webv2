generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Address {
  id                                         String      @id @default(cuid())
  userId                                     String
  type                                       AddressType @default(SHIPPING)
  firstName                                  String
  lastName                                   String
  company                                    String?
  street                                     String
  street2                                    String?
  city                                       String
  state                                      String
  zipCode                                    String
  country                                    String      @default("US")
  phone                                      String?
  isDefault                                  Boolean     @default(false)
  createdAt                                  DateTime    @default(now())
  updatedAt                                  DateTime @updatedAt
  user                                       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  billingOrders                              Order[]     @relation("orders_billingAddressIdToaddresses")
  shippingOrders                             Order[]     @relation("orders_shippingAddressIdToaddresses")

  @@map("addresses")
}

model Admin {
  id           String    @id @default(cuid())
  email        String    @unique
  passwordHash String
  firstName    String
  lastName     String
  role         AdminRole @default(ADMIN)
  isActive     Boolean   @default(true)
  lastLoginAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime @updatedAt

  @@map("admins")
}

model Category {
  id               String       @id @default(cuid())
  name             String
  slug             String       @unique
  description      String?
  image            String?
  parentId         String?
  sortOrder        Int          @default(0)
  isActive         Boolean      @default(true)
  createdAt        DateTime     @default(now())
  updatedAt        DateTime @updatedAt
  parent           Category?    @relation("categoriesTocategories", fields: [parentId], references: [id])
  children         Category[]   @relation("categoriesTocategories")
  products         Product[]

  @@map("categories")
}

model OptionValue {
  id        String   @id @default(cuid())
  optionId  String
  value     String
  label     String?
  hexCode   String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  option    Option   @relation(fields: [optionId], references: [id], onDelete: Cascade)

  @@map("option_values")
}

model Option {
  id              String            @id @default(cuid())
  name            String            @unique
  type            OptionType
  sortOrder       Int               @default(0)
  createdAt       DateTime          @default(now())
  values          OptionValue[]
  variantOptions  VariantOption[]

  @@map("options")
}

model OrderItem {
  id               String            @id @default(cuid())
  orderId          String
  productId        String
  productVariantId String?
  quantity         Int
  price            Float
  totalPrice       Float
  createdAt        DateTime          @default(now())
  order            Order             @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product          Product           @relation(fields: [productId], references: [id])
  productVariant   ProductVariant?   @relation(fields: [productVariantId], references: [id])

  @@map("order_items")
}

model Order {
  id                                            String            @id @default(cuid())
  orderNumber                                   String            @unique
  userId                                        String?
  email                                         String
  billingAddressId                              String?
  shippingAddressId                             String?
  subtotal                                      Float
  taxAmount                                     Float             @default(0)
  shippingAmount                                Float             @default(0)
  discountAmount                                Float             @default(0)
  totalAmount                                   Float
  status                                        OrderStatus       @default(PENDING)
  paymentStatus                                 PaymentStatus     @default(PENDING)
  fulfillmentStatus                             FulfillmentStatus @default(UNFULFILLED)
  notes                                         String?
  tags                                          String[]
  createdAt                                     DateTime          @default(now())
  updatedAt                                     DateTime @updatedAt
  canceledAt                                    DateTime?
  items                                         OrderItem[]
  billingAddress                                Address?          @relation("orders_billingAddressIdToaddresses", fields: [billingAddressId], references: [id])
  shippingAddress                               Address?          @relation("orders_shippingAddressIdToaddresses", fields: [shippingAddressId], references: [id])
  user                                          User?             @relation(fields: [userId], references: [id])
  payments                                      Payment[]

  @@map("orders")
}

model Payment {
  id                   String        @id @default(cuid())
  orderId              String
  amount               Float
  currency             String        @default("USD")
  status               PaymentStatus @default(PENDING)
  method               PaymentMethod
  gateway              String
  gatewayTransactionId String?
  gatewayResponse      Json?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime @updatedAt
  order                Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model Product360Image {
  id           String   @id @default(cuid())
  product_id   String
  url          String
  frame_number Int
  sort_order   Int
  created_at   DateTime @default(now()) @db.Timestamp(6)
  product      Product  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([product_id, frame_number])
  @@map("product_360_images")
}

model ProductImage {
  id        String   @id @default(cuid())
  productId String
  url       String
  altText   String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
}

model ProductInventory {
  id                String   @id @default(cuid())
  productId         String   @unique
  quantity          Int      @default(0)
  lowStockThreshold Int      @default(10)
  trackQuantity     Boolean  @default(true)
  allowBackorder    Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  product           Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_inventory")
}

model ProductVariantInventory {
  id                String           @id @default(cuid())
  productVariantId  String           @unique
  quantity          Int              @default(0)
  lowStockThreshold Int              @default(10)
  trackQuantity     Boolean          @default(true)
  allowBackorder    Boolean          @default(false)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime @updatedAt
  productVariant    ProductVariant   @relation(fields: [productVariantId], references: [id], onDelete: Cascade)

  @@map("product_variant_inventory")
}

model ProductVariant {
  id                        String                     @id @default(cuid())
  productId                 String
  name                      String
  sku                       String?                    @unique
  price                     Float?
  comparePrice              Float?
  sortOrder                 Int                        @default(0)
  isActive                  Boolean                    @default(true)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime @updatedAt
  orderItems                OrderItem[]
  inventory                 ProductVariantInventory?
  product                   Product                    @relation(fields: [productId], references: [id], onDelete: Cascade)
  variantOptions            VariantOption[]

  @@map("product_variants")
}

model Product {
  id                  String               @id @default(cuid())
  name                String
  slug                String               @unique
  description         String
  shortDescription    String?
  sku                 String?              @unique
  price               Float
  comparePrice        Float?
  costPrice           Float?
  trackInventory      Boolean              @default(true)
  metaTitle           String?
  metaDescription     String?
  imageFrames         Int                  @default(35)
  model3d             String?
  rotationImage360Url String?
  stripePriceId       String?
  categoryId          String
  isFeatured          Boolean              @default(false)
  isActive            Boolean              @default(true)
  publishedAt         DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime @updatedAt
  has_360_images      Boolean              @default(false)
  orderItems          OrderItem[]
  images360           Product360Image[]
  images              ProductImage[]
  inventory           ProductInventory?
  variants            ProductVariant[]
  category            Category             @relation(fields: [categoryId], references: [id])
  reviews             Review[]
  wishlistItems       WishlistItem[]

  @@map("products")
}

model Review {
  id                 String   @id @default(cuid())
  userId             String
  productId          String
  rating             Int
  title              String?
  content            String?
  isVerifiedPurchase Boolean  @default(false)
  isApproved         Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  product            Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("reviews")
}

model Setting {
  id        String      @id @default(cuid())
  key       String      @unique
  value     String
  type      SettingType @default(STRING)
  createdAt DateTime    @default(now())
  updatedAt DateTime @updatedAt

  @@map("settings")
}

model User {
  id                     String           @id @default(cuid())
  email                  String           @unique
  firstName              String
  lastName               String
  phone                  String?
  isAdmin                Boolean          @default(false)
  isActive               Boolean          @default(true)
  createdAt              DateTime         @default(now())
  updatedAt              DateTime @updatedAt
  passwordHash           String
  emailVerified          DateTime?
  emailVerificationToken String?
  resetPasswordToken     String?
  resetPasswordExpires   DateTime?
  avatar                 String?
  dateOfBirth            DateTime?
  addresses              Address[]
  orders                 Order[]
  reviews                Review[]
  wishlistItems          WishlistItem[]

  @@map("users")
}

model VariantOption {
  id               String           @id @default(cuid())
  productVariantId String
  optionId         String
  value            String
  option           Option           @relation(fields: [optionId], references: [id])
  productVariant   ProductVariant   @relation(fields: [productVariantId], references: [id], onDelete: Cascade)

  @@unique([productVariantId, optionId])
  @@map("variant_options")
}

model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("wishlist_items")
}

enum AddressType {
  SHIPPING
  BILLING
  BOTH
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
  MODERATOR
}

enum FulfillmentStatus {
  UNFULFILLED
  PARTIALLY_FULFILLED
  FULFILLED
}

enum OptionType {
  SIZE
  COLOR
  MATERIAL
  STYLE
  OTHER
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELED
  REFUNDED
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  APPLE_PAY
  GOOGLE_PAY
  BANK_TRANSFER
  CASH_ON_DELIVERY
}

enum PaymentStatus {
  PENDING
  AUTHORIZED
  CAPTURED
  FAILED
  CANCELED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum SettingType {
  STRING
  NUMBER
  BOOLEAN
  JSON
}
